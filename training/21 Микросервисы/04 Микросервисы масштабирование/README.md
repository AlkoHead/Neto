
# Домашнее задание к занятию «Микросервисы: масштабирование»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п. (vaoulthashicorp-vault)

Обоснуйте свой выбор.

## Ответ

### Сравнение альтернативных решений

| Критерий | Kubernetes + Vault | Docker Swarm |
|----------|--------------------|--------------|
| Поддержка контейнеров | Любые OCI-совместимые | только Docker |
| Service Discovery | Встроенный DNS + Service; внешняя маршрутизация через Ingress | Ограничено (Swarm требует внешних балансировщиков) |
| Горизонтальное масштабирование | kubectl scale или декларативно через ReplicaSet/Deployment | Да, но менее гибко |
| Автомасштабирование | HPA/VPA + Cluster Autoscaler | Swarm требует внешних инструментов |
| Разделение ресурсов | Namespaces, RBAC, NetworkPolicies | Слабое |
| Управление секретами | Vault + CSI Provider | Docker Secrets |

### Обоснование выбора Kubernetes + Vault

| Требование | Реализация в Kubernetes + Vault |
|------------|---------------------------------|
| Поддержка контейнеров | Docker, containerd, CRI-O через CRI |
| Service Discovery | DNS-based service discovery, kube-proxy, Ingress |
| Горизонтальное масштабирование | ReplicaSets, Deployments, StatefulSets |
| Автоматическое масштабирование | HPA (на метриках), VPA (на ресурсах), Cluster Autoscaler |
| Разделение ресурсов | Namespaces, ResourceQuotas, NetworkPolicies, RBAC |
| Конфигурация через переменные | ConfigMaps, Secrets, Environment Variables |
| Безопасное хранение секретов | HashiCorp Vault + CSI Provider, Kubernetes Secrets с encryption at rest |

**Вывод**: комбинация `Kubernetes` и `HashiCorp Vault` обеспечивает комплексное решение, которое соответствует всем указанным требованиям. `Kubernetes` берёт на себя оркестрацию, масштабирование и управление приложениями, а `Vault` — безопасное хранение и управление секретами.
